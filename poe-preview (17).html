<!DOCTYPE html><html lang="es"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seiyu Sorter</title>
    <!-- Pre-load html2canvas for image download functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Poppins:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            50: '#EEEEFF',
                            100: '#D8D8FF',
                            200: '#B1B0FF',
                            300: '#8A89FF',
                            400: '#7475FF',
                            500: '#5D5CDE',
                            600: '#4847B3',
                            700: '#343388',
                            800: '#21215A',
                            900: '#14142B',
                        },
                        secondary: {
                            DEFAULT: '#FF4C94',
                            50: '#FFF0F5',
                            100: '#FFD6E5',
                            200: '#FFADCB',
                            300: '#FF84B1',
                            400: '#FF6B9D',
                            500: '#FF4C94',
                            600: '#E64980',
                            700: '#AD365F',
                            800: '#74243F',
                            900: '#3A121F',
                        },
                        neutral: {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827',
                        }
                    },
                    boxShadow: {
                        'neo': '6px 6px 0 0 rgba(0, 0, 0, 0.2)',
                        'neo-sm': '4px 4px 0 0 rgba(0, 0, 0, 0.2)',
                        'neo-dark': '6px 6px 0 0 rgba(255, 255, 255, 0.1)',
                        'neo-sm-dark': '4px 4px 0 0 rgba(255, 255, 255, 0.1)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                    },
                    backdropBlur: {
                        xs: '2px',
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .bg-gradient-animated {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .dark .glass-card {
            background: rgba(17, 25, 40, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
        
        .vs-badge {
            position: relative;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF4C94, #5D5CDE);
            color: white;
            font-weight: bold;
            transform: rotate(-10deg);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            z-index: 20;
        }
        
        .dark .vs-badge {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        
        .card-hover-effect {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .card-hover-effect:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        }
        
        .dark .card-hover-effect:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .emoji-rain {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 100;
        }
        
        .emoji {
            position: absolute;
            opacity: 0;
            font-size: 24px;
            animation: emoji-fall 3s linear;
        }
        
        @keyframes emoji-fall {
            0% {
                opacity: 0;
                transform: translateY(-20vh) rotate(0deg);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white font-sans transition-colors duration-300">
    <!-- Emoji rain container for celebrations -->
    <div id="emoji-rain" class="emoji-rain hidden"></div>
    
    <!-- Background gradient effects -->
    <div class="fixed inset-0 bg-gradient-to-br from-primary-50 to-secondary-50 dark:from-primary-900 dark:to-secondary-900 opacity-50 dark:opacity-20 -z-10"></div>
    <div class="fixed top-0 left-0 right-0 h-40 bg-gradient-to-b from-white dark:from-neutral-900 to-transparent -z-10"></div>
    
    <!-- Dark mode toggle -->
    <div class="fixed top-4 right-4 z-50">
        <button id="theme-toggle" class="p-3 rounded-full bg-white dark:bg-neutral-800 shadow-neo-sm dark:shadow-neo-sm-dark transition-all hover:scale-110">
            <svg id="sun-icon" class="w-5 h-5 hidden dark:block text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
            </svg>
            <svg id="moon-icon" class="w-5 h-5 block dark:hidden text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
            </svg>
        </button>
    </div>

    <div class="container mx-auto px-4 py-8 flex flex-col items-center min-h-screen">
        <h1 class="font-display text-5xl sm:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-secondary-500 mb-8 text-center relative animate-fade-in">
            Seiyu Sorter
        </h1>
        
        <!-- Login Modal -->
        <div id="login-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden animate-fade-in">
            <div class="w-full max-w-md p-8 bg-white dark:bg-neutral-800 rounded-2xl shadow-neo dark:shadow-neo-dark transform transition-all">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-display font-bold text-primary-600 dark:text-primary-400">Admin Login</h2>
                    <p class="text-neutral-500 dark:text-neutral-400 mt-2">Accede para gestionar las seiyus</p>
                </div>
                <div class="space-y-5">
                    <div>
                        <label for="username" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Usuario</label>
                        <input type="text" id="username" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Contraseña</label>
                        <input type="password" id="password" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none">
                    </div>
                    <div id="login-error" class="text-secondary-500 text-sm hidden">Usuario o contraseña incorrectos</div>
                </div>
                <div class="mt-8 flex gap-4">
                    <button id="login-cancel-btn" class="flex-1 py-3 px-4 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 font-medium transition-colors">
                        Cancelar
                    </button>
                    <button id="login-submit-btn" class="flex-1 py-3 px-4 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl shadow-lg transform transition hover:scale-105">
                        Acceder
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Edit Seiyu Modal -->
        <div id="edit-seiyu-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden animate-fade-in">
            <div class="w-full max-w-md p-8 bg-white dark:bg-neutral-800 rounded-2xl shadow-neo dark:shadow-neo-dark transform transition-all">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-display font-bold text-primary-600 dark:text-primary-400">Editar Seiyu</h2>
                </div>
                <div class="space-y-5">
                    <input type="hidden" id="edit-seiyu-id">
                    <div>
                        <label for="edit-seiyu-name" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Nombre</label>
                        <input type="text" id="edit-seiyu-name" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none">
                    </div>
                    <div>
                        <label for="edit-seiyu-image" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">URL de la imagen</label>
                        <input type="text" id="edit-seiyu-image" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none">
                    </div>
                    <div class="mt-2 p-3 bg-neutral-100 dark:bg-neutral-700 rounded-xl text-sm text-secondary-700 dark:text-secondary-300">
                        <p class="font-medium">Dominios permitidos:</p>
                        <ul class="list-disc pl-5 mt-1 text-xs space-y-1">
                            <li>https://pfst.cf2.poecdn.net/...</li>
                            <li>https://i.imgur.com/...</li>
                            <li>https://picsum.photos/...</li>
                            <li>https://images.unsplash.com/...</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-8 flex gap-4">
                    <button id="edit-cancel-btn" class="flex-1 py-3 px-4 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 font-medium transition-colors">
                        Cancelar
                    </button>
                    <button id="edit-save-btn" class="flex-1 py-3 px-4 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl shadow-lg transform transition hover:scale-105">
                        Guardar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Export HTML Modal -->
        <div id="export-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden animate-fade-in">
            <div class="w-full max-w-4xl p-8 bg-white dark:bg-neutral-800 rounded-2xl shadow-neo dark:shadow-neo-dark transform transition-all max-h-[90vh] overflow-auto">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-display font-bold text-primary-600 dark:text-primary-400">Exportar Código HTML</h2>
                    <p class="text-neutral-500 dark:text-neutral-400 mt-2">Copia este código para guardar las modificaciones</p>
                </div>
                <div>
                    <div class="relative">
                        <pre id="export-code" class="bg-neutral-100 dark:bg-neutral-900 p-4 rounded-xl text-xs md:text-sm overflow-auto max-h-[50vh] font-mono text-neutral-800 dark:text-neutral-300 whitespace-pre-wrap border-2 border-neutral-200 dark:border-neutral-700"></pre>
                        <button id="copy-code-btn" class="absolute top-3 right-3 bg-primary-500 text-white p-2 rounded-lg hover:bg-primary-600 focus:outline-none shadow-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="copy-success" class="mt-4 text-center text-green-500 dark:text-green-400 font-medium hidden">
                        ¡Código copiado al portapapeles!
                    </div>
                </div>
                <div class="mt-8 flex justify-center">
                    <button id="export-cancel-btn" class="py-3 px-8 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 font-medium transition-colors">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Admin Screen -->
        <div id="admin-screen" class="hidden w-full max-w-5xl mt-8 animate-fade-in">
            <div class="glass-card rounded-3xl shadow-glass p-8 mb-8">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-8 pb-4 border-b-2 border-neutral-200 dark:border-neutral-700">
                    <h2 class="text-3xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-secondary-500">Panel de Administración</h2>
                    <button id="admin-logout-btn" class="py-2 px-4 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-neutral-700 dark:text-neutral-300 font-medium rounded-xl transition-colors flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Cerrar sesión
                    </button>
                </div>
                
                <!-- Form to add new seiyu -->
                <div class="mb-10 bg-white dark:bg-neutral-800 p-6 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-display font-bold text-primary-600 dark:text-primary-400 mb-6">Añadir nueva seiyu</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="new-seiyu-name" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Nombre</label>
                            <input type="text" id="new-seiyu-name" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none" placeholder="Nombre de la seiyu">
                        </div>
                        <div>
                            <label for="new-seiyu-image" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">URL de la imagen</label>
                            <input type="text" id="new-seiyu-image" class="w-full px-4 py-3 rounded-xl border-2 border-neutral-200 dark:border-neutral-700 focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-white text-base outline-none" placeholder="https://ejemplo.com/imagen.jpg">
                        </div>
                    </div>
                    <div class="mt-3 p-3 bg-neutral-100 dark:bg-neutral-700 rounded-xl text-sm text-secondary-700 dark:text-secondary-300">
                        <p class="font-medium">Dominios permitidos:</p>
                        <ul class="list-disc pl-5 mt-1 text-xs space-y-1">
                            <li>https://pfst.cf2.poecdn.net/...</li>
                            <li>https://i.imgur.com/...</li>
                            <li>https://picsum.photos/...</li>
                            <li>https://images.unsplash.com/...</li>
                        </ul>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button id="add-seiyu-btn" class="py-3 px-6 bg-secondary-500 hover:bg-secondary-600 text-white font-semibold rounded-xl shadow-lg transform transition hover:scale-105 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Añadir
                        </button>
                    </div>
                </div>
                
                <!-- Seiyu list -->
                <h3 class="text-xl font-display font-bold text-primary-600 dark:text-primary-400 mb-6">Seiyus actuales</h3>
                <div id="admin-seiyu-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                    <!-- Dynamically generated -->
                </div>
                
                <div class="flex flex-wrap justify-center gap-6">
                    <button id="export-html-btn" class="py-3 px-6 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow-lg transform transition duration-300 hover:scale-105 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                        Exportar Código HTML
                    </button>
                    
                    <button id="admin-back-btn" class="py-3 px-6 bg-primary-500 hover:bg-primary-600 text-white font-bold rounded-xl shadow-lg transform transition duration-300 hover:scale-105 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Volver al inicio
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Start Screen -->
        <div id="start-screen" class="flex flex-col items-center justify-center w-full max-w-lg py-10 animate-float">
            <!-- Decorative idol images with frames -->
            <div class="flex flex-wrap justify-center gap-6 mb-10 w-full">
                <!-- First idol image with decorative frame -->
                <div class="idol-frame relative transform rotate-[-3deg] transition-transform hover:rotate-0 hover:scale-105 duration-300">
                    <div class="absolute inset-0 bg-gradient-to-tr from-secondary-300 to-primary-300 dark:from-secondary-600 dark:to-primary-600 rounded-2xl blur-md opacity-50"></div>
                    <div class="relative p-1 bg-gradient-to-br from-white to-neutral-200 dark:from-neutral-700 dark:to-neutral-900 rounded-2xl overflow-hidden shadow-neo dark:shadow-neo-dark border-2 border-white dark:border-neutral-700">
                        <img src="https://i.imgur.com/FH1AUSS.jpeg" alt="Nozomi Nirei" class="w-36 h-36 object-cover rounded-xl">
                        <div class="absolute bottom-0 left-0 right-0 bg-black/60 backdrop-blur-sm p-2 text-white text-center text-sm font-medium">Nozomi Nirei</div>
                        <div class="absolute top-2 right-2 w-6 h-6 bg-primary-500 rounded-full flex items-center justify-center text-white text-xs font-bold">1</div>
                    </div>
                </div>
                
                <!-- Second idol image with decorative frame -->
                <div class="idol-frame relative transform rotate-[3deg] transition-transform hover:rotate-0 hover:scale-105 duration-300">
                    <div class="absolute inset-0 bg-gradient-to-tr from-primary-300 to-secondary-300 dark:from-primary-600 dark:to-secondary-600 rounded-2xl blur-md opacity-50"></div>
                    <div class="relative p-1 bg-gradient-to-br from-white to-neutral-200 dark:from-neutral-700 dark:to-neutral-900 rounded-2xl overflow-hidden shadow-neo dark:shadow-neo-dark border-2 border-white dark:border-neutral-700">
                        <img src="https://i.imgur.com/5h5DsHD.jpeg" alt="Hanamiya Nina" class="w-36 h-36 object-cover rounded-xl">
                        <div class="absolute bottom-0 left-0 right-0 bg-black/60 backdrop-blur-sm p-2 text-white text-center text-sm font-medium">Hanamiya Nina</div>
                        <div class="absolute top-2 right-2 w-6 h-6 bg-secondary-500 rounded-full flex items-center justify-center text-white text-xs font-bold">3</div>
                    </div>
                </div>
            </div>
        
            <div class="w-full glass-card rounded-3xl p-8 shadow-glass mb-8">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-display font-bold text-primary-600 dark:text-primary-400 mb-3">¡Bienvenido al Sorter!</h2>
                    <p class="text-neutral-600 dark:text-neutral-400">Elige tus seiyus favoritas comparando en parejas</p>
                </div>
                
                <div class="space-y-5">
                    <button id="start-btn" class="w-full py-4 px-6 bg-gradient-to-r from-secondary-500 to-primary-500 hover:from-secondary-600 hover:to-primary-600 text-white font-bold rounded-xl shadow-lg transform transition duration-300 hover:translate-y-[-5px] focus:outline-none focus:ring-4 focus:ring-secondary-300 dark:focus:ring-secondary-800 flex items-center justify-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Iniciar Sorter
                    </button>
                    
                    <input type="file" id="file-input" accept=".json" class="hidden">
                    <button id="load-btn" class="w-full py-3 px-6 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-xl shadow-lg transform transition duration-300 hover:translate-y-[-3px] focus:outline-none focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        Cargar Progreso
                    </button>
                    
                    <button id="admin-login-btn" class="w-full py-3 px-6 bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 font-semibold rounded-xl shadow-lg hover:bg-neutral-100 dark:hover:bg-neutral-700 transform transition duration-300 hover:translate-y-[-3px] border-2 border-neutral-200 dark:border-neutral-700 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Administrar
                    </button>
                </div>
            </div>
            
            <!-- Decorative elements -->
            <div class="flex gap-4 opacity-25 mt-10">
                <div class="w-3 h-3 rounded-full bg-primary-500 animate-pulse-slow"></div>
                <div class="w-3 h-3 rounded-full bg-secondary-500 animate-pulse-slow" style="animation-delay: 0.5s"></div>
                <div class="w-3 h-3 rounded-full bg-purple-500 animate-pulse-slow" style="animation-delay: 1s"></div>
            </div>
        </div>
        
        <!-- Sorting Screen -->
        <div id="sorting-screen" class="hidden w-full max-w-5xl px-4 animate-fade-in">
            <div class="glass-card rounded-3xl shadow-glass p-6 mb-10">
                <div class="h-7 bg-neutral-200 dark:bg-neutral-700 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-secondary-500 to-primary-500 w-0 transition-all duration-500 rounded-full"></div>
                </div>
                <div id="progress-text" class="text-center mt-2 font-semibold text-neutral-700 dark:text-neutral-300"></div>
            </div>
            
            <div id="comparison-container" class="flex flex-col md:flex-row items-center justify-between relative">
                <!-- Left Seiyu -->
                <div class="seiyu-container w-full md:w-5/12 mb-6 md:mb-0 card-hover-effect" id="seiyu-left">
                    <div class="group bg-white dark:bg-neutral-800 rounded-2xl shadow-neo dark:shadow-neo-dark overflow-hidden">
                        <div class="relative">
                            <img class="seiyu-img w-full h-64 md:h-80 object-cover object-center transition-transform duration-500 group-hover:scale-110" id="img-left" src="" alt="Seiyu izquierda">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        </div>
                        <div class="p-6">
                            <div class="seiyu-name text-xl font-display font-bold text-neutral-800 dark:text-white" id="name-left"></div>
                            <div class="mt-2 text-sm text-neutral-500 dark:text-neutral-400 flex items-center">
                                <svg class="w-4 h-4 mr-1 text-primary-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                                </svg>
                                Haz clic para elegir
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- VS Badge for desktop -->
                <div class="hidden md:flex vs-badge absolute left-1/2 top-1/3 transform -translate-x-1/2">VS</div>
                
                <!-- Controls -->
                <div id="middle-controls" class="mb-6 md:mb-0 md:absolute md:top-[85%] md:left-1/2 md:transform md:-translate-x-1/2 z-20 flex md:flex-col gap-3 p-2 bg-white/80 dark:bg-neutral-800/80 backdrop-blur-sm rounded-xl shadow-lg">
                    <button id="tie-btn" class="py-2 px-4 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transform transition duration-200 hover:scale-105 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                        </svg>
                        Empate
                    </button>
                    <button id="save-btn" class="py-2 px-4 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg shadow-md transform transition duration-200 hover:scale-105 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                        Guardar
                    </button>
                    <button id="undo-btn" class="py-2 px-4 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold rounded-lg shadow-md transform transition duration-200 hover:scale-105 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Deshacer
                    </button>
                </div>
                
                <!-- VS Badge for mobile -->
                <div class="flex md:hidden vs-badge mx-auto mb-6">VS</div>
                
                <!-- Right Seiyu -->
                <div class="seiyu-container w-full md:w-5/12 card-hover-effect" id="seiyu-right">
                    <div class="group bg-white dark:bg-neutral-800 rounded-2xl shadow-neo dark:shadow-neo-dark overflow-hidden">
                        <div class="relative">
                            <img class="seiyu-img w-full h-64 md:h-80 object-cover object-center transition-transform duration-500 group-hover:scale-110" id="img-right" src="" alt="Seiyu derecha">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        </div>
                        <div class="p-6">
                            <div class="seiyu-name text-xl font-display font-bold text-neutral-800 dark:text-white" id="name-right"></div>
                            <div class="mt-2 text-sm text-neutral-500 dark:text-neutral-400 flex items-center">
                                <svg class="w-4 h-4 mr-1 text-primary-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path>
                                </svg>
                                Haz clic para elegir
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="results-screen" class="hidden w-full max-w-2xl mt-8 animate-fade-in">
            <div id="results-container" class="glass-card rounded-3xl shadow-glass p-8 mb-8">
                <div class="relative mb-10">
                    <div class="absolute -top-10 -left-10 w-24 h-24 bg-primary-500/20 dark:bg-primary-500/10 rounded-full blur-xl"></div>
                    <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-secondary-500/20 dark:bg-secondary-500/10 rounded-full blur-xl"></div>
                    
                    <h2 class="text-3xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-secondary-500 text-center mb-6">Resultados Finales</h2>
                    <div class="h-1 w-32 mx-auto bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full"></div>
                </div>
                
                <div id="results-list" class="space-y-4"></div>
                
                <div id="result-controls" class="flex flex-wrap justify-center gap-4 mt-12">
                    <button id="restart-btn" class="py-3 px-6 bg-secondary-500 hover:bg-secondary-600 text-white font-bold rounded-xl shadow-lg transform transition duration-300 hover:scale-105 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z"></path>
                        </svg>
                        Volver a Inicio
                    </button>
                    <button id="download-results-btn" class="py-3 px-6 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-xl shadow-lg transform transition duration-300 hover:scale-105 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Descargar Resultados
                    </button>
                </div>
            </div>
            
            <!-- Loading indicator -->
            <div id="download-loading" class="hidden text-center py-3">
                <div class="inline-block animate-spin rounded-full h-10 w-10 border-4 border-neutral-300 dark:border-neutral-700 border-t-primary-500"></div>
                <p class="mt-3 text-neutral-600 dark:text-neutral-300">Generando imagen...</p>
            </div>
        </div>
    </div>
    
    <script>
        // Datos de las seiyus como array JSON incrustado en el HTML
        // Esto se actualizará cuando se exporten los cambios
const DEFAULT_SEIYUS = [
            {
                "id": 1,
                "name": "Nozomi Nirei",
                "image": "https://i.imgur.com/FH1AUSS.jpeg"
            },
            {
                "id": 2,
                "name": "Nonaka Kokona",
                "image": "https://pfst.cf2.poecdn.net/base/image/65a441e6a74c89b372f10b2ddf2402a6ca90b664512108f25498349c6636dc5e?w=440&h=440"
            },
            {
                "id": 3,
                "name": "Hanamiya Nina",
                "image": "https://i.imgur.com/5h5DsHD.jpeg"
            },
            {
                "id": 4,
                "name": "Sasaki Kotoko",
                "image": "https://i.imgur.com/Udmx6tr.jpeg"
            },
            {
                "id": 5,
                "name": "Tsukine Kona",
                "image": "https://i.imgur.com/YyC54yJ.jpeg"
            },
            {
                "id": 6,
                "name": "Kan Kana",
                "image": "https://i.imgur.com/crNPbrW.jpeg"
            },
            {
                "id": 7,
                "name": "Sakurai Hina",
                "image": "https://i.imgur.com/HzXAyqJ.jpeg"
            },
            {
                "id": 8,
                "name": "Hayama Fuka",
                "image": "https://i.imgur.com/4JS8VSG.jpeg"
            },
            {
                "id": 9,
                "name": "Kurusu Rin",
                "image": "https://i.imgur.com/jk9hR5a.jpeg"
            },
            {
                "id": 10,
                "name": "Miyake Miu",
                "image": "https://i.imgur.com/wtD3GTt.jpeg"
            },
            {
                "id": 11,
                "name": "Shindou Amane",
                "image": "https://i.imgur.com/zrOQj5I.jpeg"
            }
];
        
        // Inicializar seiyus con los valores por defecto
        let seiyus = [...DEFAULT_SEIYUS];
        
        // Constantes para login
        const ADMIN_USERNAME = "rine";
        const ADMIN_PASSWORD = "Kozue";
        
        // Variables de estado
        let comparisons = [];
        let currentComparison = 0;
        let choices = [];
        let history = [];
        let rankedSeiyus = [];
        let isLoggedIn = false;
        let nextSeiyuId = 7; // Empezamos desde el ID 7 para nuevas seiyus
        let currentEditingSeiyuId = null; // Para edición
        
        // Función para validar URL de imágenes según el CSP
        function isAllowedImageUrl(url) {
            try {
                const urlObj = new URL(url);
                const allowedDomains = [
                    'pfst.cf2.poecdn.net',
                    'i.imgur.com',
                    'picsum.photos',
                    'images.unsplash.com',
                    'wikimedia.org'
                ];
                
                return allowedDomains.some(domain => urlObj.hostname === domain || 
                                         urlObj.hostname.endsWith('.' + domain));
            } catch (e) {
                return false;
            }
        }
        
        // Función para obtener una imagen de placeholder en caso de URL no permitida
        function getPlaceholderImage(id) {
            return `https://picsum.photos/id/${id % 100}/400/400`;
        }
        
        // Elementos del DOM
        const startScreen = document.getElementById('start-screen');
        const sortingScreen = document.getElementById('sorting-screen');
        const resultsScreen = document.getElementById('results-screen');
        const adminScreen = document.getElementById('admin-screen');
        const loginModal = document.getElementById('login-modal');
        const editSeiyuModal = document.getElementById('edit-seiyu-modal');
        const exportModal = document.getElementById('export-modal');
        const resultsContainer = document.getElementById('results-container');
        const downloadLoading = document.getElementById('download-loading');
        const exportCode = document.getElementById('export-code');
        const copyCodeBtn = document.getElementById('copy-code-btn');
        const copySuccess = document.getElementById('copy-success');
        const emojiRain = document.getElementById('emoji-rain');
        
        const startBtn = document.getElementById('start-btn');
        const imgLeft = document.getElementById('img-left');
        const imgRight = document.getElementById('img-right');
        const nameLeft = document.getElementById('name-left');
        const nameRight = document.getElementById('name-right');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const tieBtn = document.getElementById('tie-btn');
        const undoBtn = document.getElementById('undo-btn');
        const saveBtn = document.getElementById('save-btn');
        const loadBtn = document.getElementById('load-btn');
        const fileInput = document.getElementById('file-input');
        const restartBtn = document.getElementById('restart-btn');
        const downloadResultsBtn = document.getElementById('download-results-btn');
        const resultsList = document.getElementById('results-list');
        const seiyuLeft = document.getElementById('seiyu-left');
        const seiyuRight = document.getElementById('seiyu-right');
        const themeToggle = document.getElementById('theme-toggle');
        
        // Admin elements
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const loginSubmitBtn = document.getElementById('login-submit-btn');
        const loginCancelBtn = document.getElementById('login-cancel-btn');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        const adminBackBtn = document.getElementById('admin-back-btn');
        const adminSeiyuList = document.getElementById('admin-seiyu-list');
        const addSeiyuBtn = document.getElementById('add-seiyu-btn');
        const newSeiyuName = document.getElementById('new-seiyu-name');
        const newSeiyuImage = document.getElementById('new-seiyu-image');
        const loginError = document.getElementById('login-error');
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const exportHtmlBtn = document.getElementById('export-html-btn');
        const exportCancelBtn = document.getElementById('export-cancel-btn');
        
        // Edit elements
        const editSeiyuId = document.getElementById('edit-seiyu-id');
        const editSeiyuName = document.getElementById('edit-seiyu-name');
        const editSeiyuImage = document.getElementById('edit-seiyu-image');
        const editCancelBtn = document.getElementById('edit-cancel-btn');
        const editSaveBtn = document.getElementById('edit-save-btn');
        
        // Emoji rain animation
        function createEmojiRain() {
            emojiRain.classList.remove('hidden');
            emojiRain.innerHTML = '';
            
            const emojis = ['🎉', '🎊', '🏆', '⭐', '✨', '💫', '🥇', '👑'];
            const numberOfEmojis = 50;
            
            for (let i = 0; i < numberOfEmojis; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.style.left = `${Math.random() * 100}%`;
                emoji.style.animationDelay = `${Math.random() * 2}s`;
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emojiRain.appendChild(emoji);
            }
            
            setTimeout(() => {
                emojiRain.classList.add('hidden');
            }, 5000);
        }
        
        // Dark mode toggle
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });
        
        // Check for system dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // Inicializar la aplicación
        function init() {
            generateAllComparisons();
            currentComparison = 0;
            choices = [];
            history = [];
            
            // Mostrar la primera comparación
            showComparison();
            
            // Actualizar barra de progreso
            updateProgress();
        }
        
        // Generar todas las comparaciones posibles
        function generateAllComparisons() {
            comparisons = [];
            for (let i = 0; i < seiyus.length; i++) {
                for (let j = i + 1; j < seiyus.length; j++) {
                    comparisons.push({ a: seiyus[i].id, b: seiyus[j].id });
                }
            }
            
            // Mezclar las comparaciones para mayor variedad
            shuffleArray(comparisons);
        }
        
        // Función para mezclar un array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Mostrar la comparación actual
        function showComparison() {
            if (currentComparison >= comparisons.length) {
                // Todas las comparaciones completadas, calcular resultados
                calculateResults();
                return;
            }
            
            const comp = comparisons[currentComparison];
            const seiyuA = seiyus.find(s => s.id === comp.a);
            const seiyuB = seiyus.find(s => s.id === comp.b);
            
            // Mostrar imágenes y nombres
            imgLeft.src = seiyuA.image;
            imgRight.src = seiyuB.image;
            nameLeft.textContent = seiyuA.name;
            nameRight.textContent = seiyuB.name;
        }
        
        // Actualizar la barra de progreso
        function updateProgress() {
            const progress = (currentComparison / comparisons.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}% completado`;
        }
        
        // Registrar una elección
        function registerChoice(winner, loser, isTie = false) {
            history.push({
                comparison: comparisons[currentComparison],
                choices: [...choices],
                currentComparison: currentComparison
            });
            
            if (isTie) {
                // En caso de empate, ambas seiyus ganan y pierden entre sí
                choices.push({ winner: winner, loser: loser });
                choices.push({ winner: loser, loser: winner });
            } else {
                choices.push({ winner: winner, loser: loser });
            }
            
            currentComparison++;
            updateProgress();
            
            if (currentComparison < comparisons.length) {
                showComparison();
            } else {
                calculateResults();
            }
        }
        
        // Deshacer la última acción
        function undoLastAction() {
            if (history.length > 0) {
                const lastState = history.pop();
                choices = lastState.choices;
                currentComparison = lastState.currentComparison;
                
                showComparison();
                updateProgress();
            }
        }
        
        // Calcular los resultados finales
        function calculateResults() {
            // Calcular el ranking basado en las elecciones
            const scores = {};
            seiyus.forEach(seiyu => {
                scores[seiyu.id] = 0;
            });
            
            choices.forEach(choice => {
                scores[choice.winner]++;
            });
            
            // Ordenar las seiyus por puntaje
            rankedSeiyus = [...seiyus];
            rankedSeiyus.sort((a, b) => scores[b.id] - scores[a.id]);
            
            // Mostrar los resultados
            displayResults();
            
            // Añadir efecto de confeti
            createEmojiRain();
        }
        
        // Mostrar los resultados en pantalla
        function displayResults() {
            sortingScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
            
            resultsList.innerHTML = '';
            
            rankedSeiyus.forEach((seiyu, index) => {
                const resultItem = document.createElement('div');
                
                if (index < 3) {
                    // Estilo especial para el top 3
                    resultItem.className = 'result-item flex items-center p-4 rounded-xl bg-gradient-to-r ' + 
                                          (index === 0 ? 'from-yellow-400 to-yellow-500' : 
                                           index === 1 ? 'from-neutral-300 to-neutral-400' :
                                           'from-amber-600 to-amber-700') + 
                                          ' text-white shadow-lg transform transition-transform hover:scale-[1.02]';
                } else {
                    resultItem.className = 'result-item flex items-center p-4 rounded-xl bg-white dark:bg-neutral-800 text-neutral-800 dark:text-white shadow-md hover:shadow-lg transition-shadow';
                }
                
                const rankDiv = document.createElement('div');
                rankDiv.className = 'result-rank text-2xl font-bold w-10 text-center ' + 
                                  (index < 3 ? 'text-white' : 'text-neutral-800 dark:text-white');
                rankDiv.textContent = `${index + 1}`;
                
                const img = document.createElement('img');
                img.className = 'result-img w-16 h-16 object-cover rounded-full border-2 ' + 
                              (index < 3 ? 'border-white' : 'border-neutral-200 dark:border-neutral-700');
                img.src = seiyu.image;
                img.alt = seiyu.name;
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'result-name text-lg font-display font-semibold ml-4 flex-grow';
                nameDiv.textContent = seiyu.name;
                
                resultItem.appendChild(rankDiv);
                resultItem.appendChild(img);
                resultItem.appendChild(nameDiv);
                
                resultsList.appendChild(resultItem);
            });
        }
        
        // Guardar el progreso actual
        function saveProgress() {
            const progressData = {
                comparisons: comparisons,
                currentComparison: currentComparison,
                choices: choices,
                history: history,
                seiyus: seiyus // Incluimos también las seiyus personalizadas
            };
            
            const dataStr = JSON.stringify(progressData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportName = 'seiyu_sorter_progress_' + new Date().toISOString().slice(0, 10) + '.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportName);
            linkElement.click();
        }
        
        // Cargar progreso desde archivo
        function loadProgress(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const progressData = JSON.parse(e.target.result);
                    
                    // Verificar si el archivo contiene datos de seiyus personalizadas
                    if (progressData.seiyus) {
                        // Aseguramos que todas las imágenes cumplen con el CSP
                        progressData.seiyus.forEach(seiyu => {
                            if (!isAllowedImageUrl(seiyu.image)) {
                                seiyu.image = getPlaceholderImage(seiyu.id);
                            }
                        });
                        
                        seiyus = progressData.seiyus;
                        // Actualizar nextSeiyuId
                        const maxId = Math.max(...seiyus.map(s => s.id));
                        nextSeiyuId = maxId + 1;
                    }
                    
                    comparisons = progressData.comparisons;
                    currentComparison = progressData.currentComparison;
                    choices = progressData.choices;
                    history = progressData.history;
                    
                    startScreen.style.display = 'none';
                    adminScreen.style.display = 'none';
                    sortingScreen.style.display = 'block';
                    
                    showComparison();
                    updateProgress();
                } catch (error) {
                    alert('Error al cargar el archivo. Por favor, asegúrate de que es un archivo de progreso válido.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }
        
        // Generar y exportar código HTML actualizado
        function exportHtmlWithUpdatedData() {
            const htmlContent = document.documentElement.outerHTML;
            
            // Crear una versión sanitizada de seiyus para incluir en el HTML
            const sanitizedSeiyus = seiyus.map(s => ({
                id: s.id,
                name: s.name,
                image: s.image
            }));
            
            // Buscar y reemplazar el array DEFAULT_SEIYUS con el array actualizado
            const defaultSeiyusRegex = /const DEFAULT_SEIYUS = \[([\s\S]*?)\];/;
            const formattedArray = JSON.stringify(sanitizedSeiyus, null, 4)
                .replace(/^(\[)/, 'const DEFAULT_SEIYUS = [')
                .replace(/(\])$/, '];')
                .replace(/^    /gm, '            ');  // Formato correcto de indentación
                
            // Mostrar el código exportado
            exportCode.textContent = formattedArray;
            exportModal.classList.remove('hidden');
        }
        
        // Función para copiar el código al portapapeles
        function copyCodeToClipboard() {
            const codeText = exportCode.textContent;
            
            // Utilizar la API Clipboard si está disponible
            if (navigator.clipboard) {
                navigator.clipboard.writeText(codeText)
                    .then(() => {
                        copySuccess.classList.remove('hidden');
                        setTimeout(() => {
                            copySuccess.classList.add('hidden');
                        }, 3000);
                    })
                    .catch(err => {
                        console.error('Error al copiar al portapapeles: ', err);
                        fallbackCopyToClipboard(codeText);
                    });
            } else {
                fallbackCopyToClipboard(codeText);
            }
        }
        
        // Método alternativo para copiar al portapapeles
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            
            // Hacer el textarea invisible
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = 0;
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copySuccess.classList.remove('hidden');
                    setTimeout(() => {
                        copySuccess.classList.add('hidden');
                    }, 3000);
                }
            } catch (err) {
                console.error('Método alternativo de copia fallido:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        // Descargar los resultados como imagen - MEJORADO
        function downloadResultsAsImage() {
            // Mostrar indicador de carga
            downloadLoading.classList.remove('hidden');
            
            // Opciones mejoradas para html2canvas
            const options = {
                scale: 2, // Mejor calidad
                useCORS: true, // Permitir imágenes cross-origin
                allowTaint: true, // Permitir "taint" para mejor soporte de imágenes
                backgroundColor: document.documentElement.classList.contains('dark') ? '#1f2937' : '#ffffff', // Color de fondo según modo
            };
            
            // Usar timeout para asegurar que la UI se actualice antes de comenzar la captura
            setTimeout(() => {
                // Capturar solo el contenedor de resultados
                html2canvas(resultsContainer, options).then(canvas => {
                    try {
                        // Crear un enlace de descarga
                        const link = document.createElement('a');
                        link.download = 'seiyu_sorter_results_' + new Date().toISOString().slice(0, 10) + '.png';
                        
                        // Convertir a formato de imagen, con máxima calidad
                        link.href = canvas.toDataURL('image/png', 1.0);
                        
                        // Simular clic para descargar
                        link.click();
                        
                        // Ocultar indicador de carga
                        downloadLoading.classList.add('hidden');
                    } catch (error) {
                        console.error('Error al generar la descarga:', error);
                        alert('Error al generar la imagen. Por favor, inténtalo de nuevo.');
                        downloadLoading.classList.add('hidden');
                    }
                }).catch(error => {
                    console.error('Error en html2canvas:', error);
                    alert('No se pudo generar la imagen. Es posible que algunas imágenes no se puedan cargar correctamente.');
                    downloadLoading.classList.add('hidden');
                });
            }, 100);
        }
        
        // Mostrar la lista de seiyus en el panel de administración
        function displayAdminSeiyuList() {
            adminSeiyuList.innerHTML = '';
            
            seiyus.forEach(seiyu => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-neutral-800 rounded-xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl hover:translate-y-[-5px]';
                
                const img = document.createElement('img');
                img.src = seiyu.image;
                img.alt = seiyu.name;
                img.className = 'w-full h-40 object-cover';
                
                const content = document.createElement('div');
                content.className = 'p-4';
                
                const name = document.createElement('div');
                name.className = 'font-bold text-neutral-800 dark:text-white';
                name.textContent = seiyu.name;
                
                const actions = document.createElement('div');
                actions.className = 'mt-3 flex justify-between items-center text-xs text-neutral-500 dark:text-neutral-400';
                
                const idTag = document.createElement('span');
                idTag.textContent = `ID: ${seiyu.id}`;
                
                const btnContainer = document.createElement('div');
                btnContainer.className = 'flex space-x-2';
                
                // Botón de editar - disponible para todas las seiyus
                const editBtn = document.createElement('button');
                editBtn.className = 'text-blue-500 hover:text-blue-600 p-1 rounded hover:bg-blue-100/50 dark:hover:bg-blue-900/30';
                editBtn.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                `;
                editBtn.addEventListener('click', () => {
                    openEditModal(seiyu);
                });
                
                btnContainer.appendChild(editBtn);
                
                // Botón de eliminar - solo para seiyus personalizadas (id ≥ 7)
                if (seiyu.id >= 7) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'text-secondary-500 hover:text-secondary-600 p-1 rounded hover:bg-secondary-100/50 dark:hover:bg-secondary-900/30';
                    deleteBtn.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    `;
                    deleteBtn.addEventListener('click', () => {
                        if (confirm(`¿Seguro que quieres eliminar a ${seiyu.name}?`)) {
                            seiyus = seiyus.filter(s => s.id !== seiyu.id);
                            displayAdminSeiyuList();
                        }
                    });
                    btnContainer.appendChild(deleteBtn);
                }
                
                actions.appendChild(idTag);
                actions.appendChild(btnContainer);
                
                content.appendChild(name);
                content.appendChild(actions);
                
                card.appendChild(img);
                card.appendChild(content);
                
                adminSeiyuList.appendChild(card);
            });
        }
        
        // Abrir modal de edición
        function openEditModal(seiyu) {
            currentEditingSeiyuId = seiyu.id;
            editSeiyuId.value = seiyu.id;
            editSeiyuName.value = seiyu.name;
            editSeiyuImage.value = seiyu.image;
            editSeiyuModal.classList.remove('hidden');
        }
        
        // Guardar cambios de edición
        function saveSeiyuEdit() {
            const id = parseInt(editSeiyuId.value);
            const name = editSeiyuName.value.trim();
            const imageUrl = editSeiyuImage.value.trim();
            
            if (!name || !imageUrl) {
                alert('Por favor, completa todos los campos.');
                return;
            }
            
            // Validar la URL de la imagen según el CSP
            if (!isAllowedImageUrl(imageUrl)) {
                alert('La URL de la imagen no está permitida por la política de seguridad. Por favor, usa una imagen de los dominios sugeridos.');
                return;
            }
            
            // Encontrar y actualizar la seiyu
            const seiyuIndex = seiyus.findIndex(s => s.id === id);
            if (seiyuIndex !== -1) {
                seiyus[seiyuIndex].name = name;
                seiyus[seiyuIndex].image = imageUrl;
                
                // Actualizar la lista
                displayAdminSeiyuList();
                
                // Cerrar modal
                editSeiyuModal.classList.add('hidden');
                
                alert('¡Seiyu actualizada con éxito! Recuerda exportar el HTML para guardar los cambios permanentemente.');
            }
        }
        
        // Añadir una nueva seiyu
        function addNewSeiyu() {
            const name = newSeiyuName.value.trim();
            const imageUrl = newSeiyuImage.value.trim();
            
            if (!name || !imageUrl) {
                alert('Por favor, completa todos los campos.');
                return;
            }
            
            // Validar la URL de la imagen según el CSP
            if (!isAllowedImageUrl(imageUrl)) {
                alert('La URL de la imagen no está permitida por la política de seguridad. Por favor, usa una imagen de los dominios sugeridos.');
                return;
            }
            
            // Crear nueva seiyu
            const newSeiyu = {
                id: nextSeiyuId++,
                name: name,
                image: imageUrl
            };
            
            // Añadir a la lista
            seiyus.push(newSeiyu);
            
            // Actualizar la lista en el panel admin
            displayAdminSeiyuList();
            
            // Limpiar el formulario
            newSeiyuName.value = '';
            newSeiyuImage.value = '';
            
            alert(`¡Seiyu ${name} añadida con éxito! Recuerda exportar el HTML para guardar los cambios permanentemente.`);
        }
        
        // Función para manejar el login
        function handleLogin() {
            const user = username.value.trim();
            const pass = password.value;
            
            if (user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
                // Login exitoso
                isLoggedIn = true;
                loginModal.classList.add('hidden');
                startScreen.style.display = 'none';
                adminScreen.style.display = 'block';
                
                // Mostrar la lista de seiyus
                displayAdminSeiyuList();
                
                // Limpiar campos
                username.value = '';
                password.value = '';
                loginError.classList.add('hidden');
            } else {
                // Login fallido
                loginError.classList.remove('hidden');
                password.value = '';
            }
        }
        
        // Event listeners
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            sortingScreen.style.display = 'block';
            init();
        });
        
        seiyuLeft.addEventListener('click', () => {
            const comp = comparisons[currentComparison];
            registerChoice(comp.a, comp.b);
        });
        
        seiyuRight.addEventListener('click', () => {
            const comp = comparisons[currentComparison];
            registerChoice(comp.b, comp.a);
        });
        
        tieBtn.addEventListener('click', () => {
            const comp = comparisons[currentComparison];
            registerChoice(comp.a, comp.b, true);
        });
        
        undoBtn.addEventListener('click', undoLastAction);
        
        saveBtn.addEventListener('click', saveProgress);
        
        loadBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', loadProgress);
        
        restartBtn.addEventListener('click', () => {
            resultsScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });
        
        downloadResultsBtn.addEventListener('click', downloadResultsAsImage);
        
        // Admin event listeners
        adminLoginBtn.addEventListener('click', () => {
            loginModal.classList.remove('hidden');
        });
        
        loginSubmitBtn.addEventListener('click', handleLogin);
        
        password.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });
        
        loginCancelBtn.addEventListener('click', () => {
            loginModal.classList.add('hidden');
            username.value = '';
            password.value = '';
            loginError.classList.add('hidden');
        });
        
        adminLogoutBtn.addEventListener('click', () => {
            isLoggedIn = false;
            adminScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });
        
        adminBackBtn.addEventListener('click', () => {
            adminScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });
        
        addSeiyuBtn.addEventListener('click', addNewSeiyu);
        
        // Edit modal event listeners
        editCancelBtn.addEventListener('click', () => {
            editSeiyuModal.classList.add('hidden');
        });
        
        editSaveBtn.addEventListener('click', saveSeiyuEdit);
        
        // Export HTML event listeners
        exportHtmlBtn.addEventListener('click', exportHtmlWithUpdatedData);
        exportCancelBtn.addEventListener('click', () => {
            exportModal.classList.add('hidden');
        });
        copyCodeBtn.addEventListener('click', copyCodeToClipboard);
        
        // Precargar imágenes para mejor experiencia de usuario
        window.onload = function() {
            seiyus.forEach(seiyu => {
                const img = new Image();
                img.src = seiyu.image;
            });
        };
    </script>

</body></html>